-- Fix SECURITY DEFINER views by setting security_invoker = on
-- This ensures views respect the querying user's RLS policies instead of the view owner's

ALTER VIEW public.service_costs_by_org SET (security_invoker = on);
ALTER VIEW public.service_usage_daily SET (security_invoker = on);
ALTER VIEW public.services_overview SET (security_invoker = on);
ALTER VIEW public.v_active_leases SET (security_invoker = on);
ALTER VIEW public.v_admin_dashboard SET (security_invoker = on);
ALTER VIEW public.v_affiliate_performance SET (security_invoker = on);
ALTER VIEW public.v_ai_app_context SET (security_invoker = on);
ALTER VIEW public.v_ai_costs_summary SET (security_invoker = on);
ALTER VIEW public.v_ai_errors SET (security_invoker = on);
ALTER VIEW public.v_ai_persona_context SET (security_invoker = on);
ALTER VIEW public.v_ai_system_prompts SET (security_invoker = on);
ALTER VIEW public.v_ai_top_features SET (security_invoker = on);
ALTER VIEW public.v_ai_usage_by_model SET (security_invoker = on);
ALTER VIEW public.v_ai_usage_daily_by_app SET (security_invoker = on);
ALTER VIEW public.v_app_pricing SET (security_invoker = on);
ALTER VIEW public.v_buildings_summary SET (security_invoker = on);
ALTER VIEW public.v_cost_type_usage SET (security_invoker = on);
ALTER VIEW public.v_cross_sell_recommendations SET (security_invoker = on);
ALTER VIEW public.v_current_tariffs SET (security_invoker = on);
ALTER VIEW public.v_fintutto_ecosystem SET (security_invoker = on);
ALTER VIEW public.v_heatpump_efficiency SET (security_invoker = on);
ALTER VIEW public.v_meters_with_last_reading SET (security_invoker = on);
ALTER VIEW public.v_meters_with_readings SET (security_invoker = on);
ALTER VIEW public.v_monthly_consumption SET (security_invoker = on);
ALTER VIEW public.v_my_conversations SET (security_invoker = on);
ALTER VIEW public.v_my_unread_notifications SET (security_invoker = on);
ALTER VIEW public.v_open_tasks SET (security_invoker = on);
ALTER VIEW public.v_operating_cost_building_summary SET (security_invoker = on);
ALTER VIEW public.v_operating_cost_deadlines SET (security_invoker = on);
ALTER VIEW public.v_operating_cost_summary SET (security_invoker = on);
ALTER VIEW public.v_partner_overview SET (security_invoker = on);
ALTER VIEW public.v_persona_analytics SET (security_invoker = on);
ALTER VIEW public.v_recent_activity SET (security_invoker = on);
ALTER VIEW public.v_stripe_products_with_prices SET (security_invoker = on);
ALTER VIEW public.v_tasks_with_chat SET (security_invoker = on);
ALTER VIEW public.v_tenant_dashboard SET (security_invoker = on);
ALTER VIEW public.v_units_with_lease SET (security_invoker = on);
ALTER VIEW public.v_unmatched_transactions SET (security_invoker = on);